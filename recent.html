<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>KZ Profile</title>
  <!-- Icon -->
  <link rel="icon" href="img/Logo.png" type="image/x-icon">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="css/mdb.min.css">
  <!-- Custom styles -->
  <link rel="stylesheet" href="css/style.css">
  <!-- MDBootstrap Datatables  -->
  <link href="css/addons/datatables.min.css" rel="stylesheet">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E832KC363V"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-E832KC363V');
  </script>
</head>
<body>

  <!-- Start -->  

    <!--Navbar-->
    <nav class="navbar navbar-expand-lg navbar-dark elegant-color">
      <div class="container">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggler"
          aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarToggler">
          <!-- Links -->
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">Profile</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="maps.html">Maps</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="recent.html">Recent
                <span class="sr-only">(current)</span>
              </a>
            </li>

            <!-- Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" id="navbarDropdownCommunityLink" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">Community</a>
              <div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownCommunityLink">
								<a class="dropdown-item" href="leaderboard.html">Leaderboards</a>
								<a class="dropdown-item" href="servers.html">Servers</a>
                <a class="dropdown-item" href="players.html">Players</a>
                <a class="dropdown-item" href="bans.html">Bans</a>
              </div>
            </li>

            <!-- Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">Extras</a>
              <div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="https://forum.gokz.org/" target="_blank">Forum</a>
                <a class="dropdown-item" href="https://syuks.github.io/DistbugCalculator/" target="_blank">Distbug Calculator</a>
                <a class="dropdown-item" href="https://www.youtube.com/c/Syuks" target="_blank">Tutorials</a>
              </div>
            </li>

          </ul>
          <!-- Links -->

          <form id="multiPurposeForm" class="form-inline" method="GET" autocomplete="off" style="margin-right: 20px;">
            <div class="md-form my-0">
              <input id="multiPurposeInput" class="form-control mr-sm-2 multi-purpose-input" type="text" placeholder="Search" aria-label="Search" minlength="3">
              <i class="fas fa-search" aria-hidden="true"></i>
            </div>
          </form>
          <div id="userLogin"></div>
        </div>
      </div>
    </nav>
    <!--/.Navbar-->

    <div class="container">

      <!--Mode Chooser-->
      <div class="row configuration-row">
        <div class="col text-center">
          <!-- KZTimer -->
          <div class="custom-control-inline">
            <input class="configuration-radio" type="radio"  id="kztimerRadio" value="kz_timer" name="game_mode" checked>
            <label class="radio-label" for="kztimerRadio">KZ Timer</label>
          </div>

          <!-- SimpleKZ -->
          <div class="custom-control-inline">
            <input class="configuration-radio" type="radio" id="simplekzRadio" value="kz_simple" name="game_mode">
            <label class="radio-label" for="simplekzRadio">Simple KZ</label>
          </div>

          <!-- Vanilla -->
          <div class="custom-control-inline">
            <input class="configuration-radio" type="radio" id="vanillaRadio" value="kz_vanilla" name="game_mode">
            <label class="radio-label" for="vanillaRadio">Vanilla</label>
          </div>
        </div>
      </div>
      <!--Mode Chooser-->

      <div class="row">

        <div class="col-lg-6 text-center">
          
          <h1 style="font-weight: 400;margin-top: 40px;">PRO Records</h1>

          <div id="pro-records"></div>
        
        </div>

        <!--Only Mobile-->
        <div class="loadMoreCards text-center d-none" style="width:100%; margin-top: 30px;">
          <a id="loadMoreCardsMobile" ><i class="fas fa-chevron-down"></i></a>
        </div>
        
        <div class="col-lg-6 text-center">
          
          <h1 style="font-weight: 400;margin-top: 40px;">TP Records</h1>

          <div id="tp-records"></div>
        
        </div>
      </div>

      <div class="row text-center" style="margin-top: 30px;">
        <div class="col">
          <a id="loadMoreCards"><i class="fas fa-chevron-down"></i></a>
        </div>
      </div>

      <div class="row z-depth-1-half" style="margin-top: 50px;">
        <div class="col">

          <!-- TABLE HEADER -->
          <div class="row table-top">
            <!-- 1. Refresh Button -->
            <div class="col d-flex align-items-center" id="refreshColumn">
              <a id="refreshButton">
                <i class="fas fa-redo-alt"></i>
              </a>
            </div>
            <!-- 2. Table state changer -->
            <div class="col d-flex align-items-center justify-content-center">
              <div class="text-center" id="table-state-title" style="width: 150px;">
                Top 100s
              </div>
            </div>
            <!-- 3. Search form -->
            <div class="col d-flex flex-row-reverse align-items-center">
              <form class="form-inline md-form form-sm mt-0 mb-0" autocomplete="off" onsubmit="return false">
                <input id="finishedMapsSearch" class="form-control form-control-sm mr-3 w-75" type="text" placeholder="Search" aria-label="Search">
                <i class="fas fa-search" aria-hidden="true"></i>
              </form>
            </div>
          </div>

          <!-- TABLE -->
          <div class="row">
            <!-- FINISHED MAPS TABLE -->
            <div class="table-responsive">
              <table id="Top100s" class="table-sm table-borderless table-hover table-dark text-center text-nowrap">
                <thead class="z-depth-1">
                  <tr>
                    <th class="text-center th-lg">Top</th>
                    <th class="th-lg">Player</th>
                    <th class="th-lg">Map</th>
                    <th class="th-lg">Time</th>
                    <th class="th-lg">Date</th>
                    <th class="th-lg">Server</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>  
    
  <!-- End -->

  <!-- jQuery -->
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <!-- Datatables  -->
  <script type="text/javascript" src="js/addons/datatables.min.js"></script>
  <!-- Autocomplete: https://github.com/Honatas/bootstrap-4-autocomplete  -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-4-autocomplete/dist/bootstrap-4-autocomplete.min.js" crossorigin="anonymous"></script>
  <!-- My Utility functions-->
  <script type="text/javascript" src="js/myUtils.js"></script>
  <!-- Humanized Time Span-->
  <script type="text/javascript" src="js/HumanizedTimeSpan.js"></script>
  <!-- Custom scripts -->
  <script type="text/javascript">

    var recentWRRequest;
    var currentWRRecentData;

    var recentTOP100Request;
    var currentTOP100RecentData;
    
    var proSteamid64s;
    var tpSteamid64s;
    var proCardsDisplayed = 0;
    var tpCardsDisplayed = 0;

    //Datatables
    var t;

    var timezoneOffset = new Date().getTimezoneOffset();

    //LOGIN LOGIC
    var storedSteamData = JSON.parse(localStorage.getItem('steamProfileData'));
    if (storedSteamData!=null) {
      $("#userLogin").html('<div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img class="rounded-circle" src="' + storedSteamData.response.players[0].avatar + '"></a><div class="dropdown-menu"><a class="dropdown-item waves-effect waves-light" href="extras/steam.html?logout=true">Logout</a></div></div>');
    } else {
      $("#userLogin").html('<a onclick="loadOpenID();"><img src="https://community.cloudflare.steamstatic.com/public/images/signinthroughsteam/sits_01.png"></a>');
    }

    $(document).ready(function () {

      //Local Storage
      var storedSteamID = localStorage.getItem('steamid');
      var storedGameMode = localStorage.getItem('game_mode');

      //UI Elements
      var multiPurposeInput = $("#multiPurposeInput");
      var gameModeSelector = $("input[type='radio'][name='game_mode']");
      
      //Finished Maps Datatable Initialization
      t = $('#Top100s').DataTable({
                  "iDisplayLength": 100,
                  "aaSorting": [],  //disables initial sorting
                  "columnDefs": [
                    { "targets": 5 , className: "text-left"}, //para que los servers se justifiquen en la izquierda
                    { "orderable": false, "targets": [0,1,2,3,4,5] }
                  ],
                  'rowCallback': function(row, data, index){      //tengo que cambiarles el color aca porque ponerlos con span no ordena numericamente
                    if(data[1].includes(localStorage.getItem('steamid'))){
                      $(row).css('background-color', '#2E2E2E');
                    }
                  },
                  "dom": 'rt' //con esto elijo que partes de la datatable aparezcan: default: 'lfrtip' (length slector, filter input, ¿procesing element?, table, information, pagination)
                });
      $('.dataTables_length').addClass('bs-select');
          
      $.ajax({url: "https://kztimerglobal.com/api/v2.0/maps?is_validated=true&limit=1000", dataType: 'json', success: function(result){
        
        var maps = result;

        //Autocomplete Initialization
        multiPurposeInput.autocomplete({
          dropdownClass: "mapsDropdown",
          source: maps,
          label: "name",
          treshold:2,
          onSelectItem: onSelectAutocomplete
        });
      }});
    
      //Autocomplete Selection Callback
      function onSelectAutocomplete (item, element) {
        multiPurposeInput.blur(); //para hacer defocus en el input asi no sigue apareciendo el dropdown
        window.location.href = 'maps.html?map=' + item.label;
      }

      //If Enter is pressed on the multi purpose form
      $("#multiPurposeForm").submit(function( event ) {
        //it can be a map, a player name, a steam profile, a steam64 or a steam32
        let searchValue = multiPurposeInput.val();
        let mapsDropdown = $('.mapsDropdown');

        //The dropdown options have priority
        if (mapsDropdown.children().length > 0) {
          mapsDropdown.children(":first").trigger('click');
        } else {
          //MAP (non globals for example)
          if (isValidKZMap(searchValue)) {
            window.location.href = 'maps.html?map=' + searchValue;
          //STEAM 32/64
          } else if (GetSteam32(searchValue)!=null) { //this function checks both 64 and 32 bit ids, will always return the 32 if input is valid
            window.location.href = "/?steamid=" + GetSteam32(searchValue);
          //Vanity Profiles
          } else if (isValidVanityProfile(searchValue)) {
            let vanityID = searchValue.split("/id/").pop().replace("/",""); //if there is a / at the end I don't want it, little unsafe
            $.ajax({
              url: "https://kzprofile.kreedz.top/api/v1/steam/vanity?url=" + vanityID,
              dataType: 'json',
              success: function(result){
                window.location.href = "/?steamid=" + GetSteam32(result.response.steamid);
              },
              error: function(){
                alert("Either this profile is invalid or the steam proxy is down.");
              }
            });
          //Legacy Profiles
          } else if (isValidSteamProfile(searchValue)) {
            window.location.href = "/?steamid=" + GetSteam32(searchValue.split("/profiles/").pop().match(/\d+/)); //just get the numbers, safer (steam64)
          //If they search for anything else, search a player with that name
          } else {
            window.location.href = "players.html?player=" + searchValue;
          }
        }
        return false;
      });

      //focus multipurposeinput on empty key press
      $(document).on('keypress',function() {
        if ( $('input:focus').length == 0) {
          multiPurposeInput.focus();
        }
      });

      //First of all see if there are parameters in url. If there is one, load data from that, if there isn't load saved ones
      var gameModeParameter = new URLSearchParams(window.location.search).get("mode");

      //GAME MODE PARAMETER
      if (gameModeParameter == "kz_timer" || gameModeParameter == "kz_simple" || gameModeParameter == "kz_vanilla"){
        $("input[type='radio'][name=game_mode][value=" + gameModeParameter + "]").prop('checked', true);
      } else {
        //If there is no gamemode in the url, get stored gamemode if there is one
        if (storedGameMode!=null){
          $("input[type='radio'][name=game_mode][value=" + storedGameMode + "]").prop('checked', true);
        }
      }

      GetRecentData();

      //If the radio group state is changed (Game Type)
      $("input[name='game_mode']").click(function() {
        GetRecentData();
      });

      //Getting the data from the API
      function GetRecentData(){

        history.replaceState({mapParams: "1"}, "", "recent.html?mode=" + gameModeSelector.groupVal());

        //Primero que nada borramos todos los datos para mostrar que estamos buscando unos nuevos
        $("#pro-records").html("");
        $("#tp-records").html("");
        proSteamid64s = [];
        tpSteamid64s = [];
        proCardsDisplayed = 0;
        tpCardsDisplayed = 0;

        if (recentWRRequest != null && recentWRRequest.readyState < 4) {
          recentWRRequest.abort();  //abort ajax request if another one is needed
        }

        if (recentTOP100Request != null && recentTOP100Request.readyState < 4) {
          recentTOP100Request.abort();  //abort ajax request if another one is needed
        }

        //RECENT WR DATA
        recentWRRequest = $.ajax({url: "https://kztimerglobal.com/api/v2.0/records/top/recent?tickrate=128&stage=0&modes_list_string=" + gameModeSelector.groupVal() + "&place_top_at_least=1&limit=100", dataType: 'json', success: function(result){
          
          currentWRRecentData = result;

          for (let i = 0; i < currentWRRecentData.length; i++) {
            if (currentWRRecentData[i].teleports == 0) {
              proSteamid64s.push({"id": i, "steam64": currentWRRecentData[i].steamid64});
            } else {
              tpSteamid64s.push({"id": i, "steam64": currentWRRecentData[i].steamid64});
            }
          }

          ShowRecentData();

        }});

        GetTOP100Data();

      }

      //If the down arrow is clicked (Load 5 more wrs)
      $("#loadMoreCards").click(function() {
        ShowRecentData();
      });
      $("#loadMoreCardsMobile").click(function() {
        ShowRecentData();
      });

      function ShowRecentData(){

        //MUST PUT THE LIMIT IN VARIABLE TO PREVENT INFINITE LOOP
        let proLimit = proCardsDisplayed +5 < proSteamid64s.length ? proCardsDisplayed +5 : proSteamid64s.length;;

        for (var i = proCardsDisplayed; i < proLimit; i++) {

          let runIndex = proSteamid64s[i].id;

          //Transform time
          var map_time;
          if (currentWRRecentData[runIndex].time/86400 < 1) {
            map_time = new Date(currentWRRecentData[runIndex].time * 1000).toISOString().substr(11, 11);
          } else {
            var days = Math.floor(currentWRRecentData[runIndex].time/86400);
            map_time = new Date(currentWRRecentData[runIndex].time * 1000).toISOString();
            var totalHours = parseFloat(map_time.substr(11, 2)) + 24 * days;
            map_time = `${totalHours}${map_time.substr(13, 9)}`;
          }

          //Time passed
          let d = new Date(currentWRRecentData[runIndex].created_on);
          let time_passed = Date.parse(d) - (timezoneOffset*60*1000); //parse gives miliseconds

          $("#pro-records").append(
            `<div class="card bg-dark hvr-grow-shadow text-left embed-responsive embed-responsive-16by9" style="max-height: 253px;max-width: 450px;margin-top:50px;">
              <div class="embed-responsive-item">
                <img class="card-img" src="https://raw.githubusercontent.com/KZGlobalTeam/map-images/public/webp/` + currentWRRecentData[runIndex].map_name + `.webp" onerror="this.src='img/kz.png'">
                
                <div class="card-img-overlay">
                  <a href="maps.html?map=` + currentWRRecentData[runIndex].map_name + `&mode=` + gameModeSelector.groupVal() + `&run=pro" class="stretched-link"></a>
                  <div class="row" style="height: 50%;">
                    <div class="col-9"></div>
                    <div class="col-3">
                      <img src="` + GetAchievementSticker(currentWRRecentData[runIndex].map_id) + `">  
                    </div>
                  </div>
                  <div class="row align-items-end" style="height: 50%;">
                    <div class="col-3" style="margin-bottom:5px">
                      <a href="/?steamid=` + currentWRRecentData[runIndex].steam_id + `&mode=` + gameModeSelector.groupVal() + `&run=pro` + `" style="z-index: 1;position: relative;">
                        <img class="img-fluid rounded-circle ` + proSteamid64s[i].steam64 + `" src="img/kz.gif">
                      </a>
                    </div>
                    <div class="col-9" style="padding-left: 0px;">
                      <div><a style="font-size:20px;z-index: 1;position: relative;" href="maps.html?map=` + currentWRRecentData[runIndex].map_name + `&mode=` + gameModeSelector.groupVal() + `&run=pro">` + currentWRRecentData[runIndex].map_name + `</a></div>
                      <div><a style="font-size:15px;z-index: 1;position: relative;" href="/?steamid=` + currentWRRecentData[runIndex].steam_id + `&mode=` + gameModeSelector.groupVal() + `&run=pro` + `">` + currentWRRecentData[runIndex].player_name + `</a></div>
                      <div style="font-size:15px; opacity: 0.6;">` + map_time + ` • ` + humanized_time_span(new Date (time_passed)) + `</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>`);
          proCardsDisplayed++;
        }

        //MUST PUT THE LIMIT IN VARIABLE TO PREVENT INFINITE LOOP
        let tpLimit = tpCardsDisplayed +5 < tpSteamid64s.length ? tpCardsDisplayed +5 : tpSteamid64s.length;

        for (let i = tpCardsDisplayed; i < tpLimit; i++) {

          let runIndex = tpSteamid64s[i].id;

          //Transform time
          var map_time;
          if (currentWRRecentData[runIndex].time/86400 < 1) {
            map_time = new Date(currentWRRecentData[runIndex].time * 1000).toISOString().substr(11, 11);
          } else {
            var days = Math.floor(currentWRRecentData[runIndex].time/86400);
            map_time = new Date(currentWRRecentData[runIndex].time * 1000).toISOString();
            var totalHours = parseFloat(map_time.substr(11, 2)) + 24 * days;
            map_time = `${totalHours}${map_time.substr(13, 9)}`;
          }

          //Time passed
          let d = new Date(currentWRRecentData[runIndex].created_on);
          let time_passed = Date.parse(d) - (timezoneOffset*60*1000); //parse gives miliseconds

          $("#tp-records").append(
            `<div class="card bg-dark hvr-grow-shadow text-left embed-responsive embed-responsive-16by9" style="max-height: 253px;max-width: 450px;margin-top:50px;">
              <div class="embed-responsive-item">
                <img class="card-img" src="https://raw.githubusercontent.com/KZGlobalTeam/map-images/public/webp/` + currentWRRecentData[runIndex].map_name + `.webp" onerror="this.src='img/kz.png'">
                
                <div class="card-img-overlay">
                  <a href="maps.html?map=` + currentWRRecentData[runIndex].map_name + `&mode=` + gameModeSelector.groupVal() + `&run=tp" class="stretched-link"></a>
                  <div class="row align-items-end" style="height: 100%;">
                    <div class="col-3" style="margin-bottom:5px">
                      <a href="/?steamid=` + currentWRRecentData[runIndex].steam_id + `&mode=` + gameModeSelector.groupVal() + `&run=tp` + `" style="z-index: 1;position: relative;">
                        <img class="img-fluid rounded-circle ` + tpSteamid64s[i].steam64 + `" src="img/kz.gif">
                      </a>
                    </div>
                    <div class="col-9" style="padding-left: 0px;">
                      <div><a style="font-size:20px;z-index: 1;position: relative;" href="maps.html?map=` + currentWRRecentData[runIndex].map_name + `&mode=` + gameModeSelector.groupVal() + `&run=tp">` + currentWRRecentData[runIndex].map_name + `</a></div>
                      <div><a style="font-size:15px;z-index: 1;position: relative;" href="/?steamid=` + currentWRRecentData[runIndex].steam_id + `&mode=` + gameModeSelector.groupVal() + `&run=tp` + `">` + currentWRRecentData[runIndex].player_name + `</a></div>
                      <div style="font-size:15px; opacity: 0.6;">` + map_time + ` • ` + humanized_time_span(new Date (time_passed)) + `</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>`);
          tpCardsDisplayed++;
        }

        GetSteamProfiles();

        t.draw();
      }

      function GetSteamProfiles(){
        
        let steamQueryString = "https://kzprofile.kreedz.top/api/v1/steam?steamids="

        //no es NECESARIO se exacto en esto, con menos 5 ya esta, a pesar de que a veces sean menos las que necestio porque llegue al límite.
        let proStartLoop = proCardsDisplayed - 5;
        let tpStartLoop = tpCardsDisplayed - 5;

        for (let i = proStartLoop; i < proCardsDisplayed; i++) {
          steamQueryString += (proSteamid64s[i].steam64 + ",");
        }
        for (let i = tpStartLoop; i < tpCardsDisplayed; i++) {
          steamQueryString += (tpSteamid64s[i].steam64 + ",");
        }
        
        $.ajax({url: steamQueryString, dataType: 'json', success: function(result){
          
          for (let i = 0; i < result.response.players.length; i++) {
            $("."+result.response.players[i].steamid).attr("src",result.response.players[i].avatarmedium);
          }
        }});
      }

      //What happens when i click the Refresh Button on the table
      $("#refreshButton").click(function() {
        GetTOP100Data();
      });

      function GetTOP100Data() {
        t.clear();
        t.draw();

        recentTOP100Request = $.ajax({url: "https://kztimerglobal.com/api/v2.0/records/top/recent?tickrate=128&stage=0&modes_list_string=" + gameModeSelector.groupVal() + "&limit=100", dataType: 'json', success: function(result){
          //I must get the info as a string insted of an object so i can substring the steam64 out of the data
          currentTOP100RecentData = result;

          ShowTOP100Data();

        }});
      }

      function ShowTOP100Data() {
        for (let i = 0; i < currentTOP100RecentData.length; i++) {

          //Transform time
          var map_time;
          if (currentTOP100RecentData[i].time/86400 < 1) {
            map_time = new Date(currentTOP100RecentData[i].time * 1000).toISOString().substr(11, 11);
          } else {
            var days = Math.floor(currentTOP100RecentData[i].time/86400);
            map_time = new Date(currentTOP100RecentData[i].time * 1000).toISOString();
            var totalHours = parseFloat(map_time.substr(11, 2)) + 24 * days;
            map_time = `${totalHours}${map_time.substr(13, 9)}`;
          }

          //Time passed
          let d = new Date(currentTOP100RecentData[i].created_on);
          let time_passed = Date.parse(d) - (timezoneOffset*60*1000); //parse gives miliseconds

          t.row.add( [
            currentTOP100RecentData[i].teleports > 0 ? currentTOP100RecentData[i].place + " (TP)" : '<img src="' + GetAchievementSticker(currentTOP100RecentData[i].map_id) + '">' + currentTOP100RecentData[i].place + ' (PRO)',
            '<a href="/?steamid=' + currentTOP100RecentData[i].steam_id + '">' + currentTOP100RecentData[i].player_name + '</a>',
            '<a href="maps.html?map=' + currentTOP100RecentData[i].map_name + '">' + currentTOP100RecentData[i].map_name + '</a>',
            map_time,
            humanized_time_span(new Date (time_passed)),
            currentTOP100RecentData[i].server_name
          ]);
        }
        t.draw();
      }

      //sinconizar la search box con la tabla
      $('#finishedMapsSearch').keyup(function(){
        t.search($(this).val()).draw();
      });
      
      function GetAchievementSticker (map_id) {
        let imgSource = "";
        switch (map_id) {
          case 220 : imgSource = "img/Stickers/80/Combine-Helmet.png"; break;
          case 247 : imgSource = "img/Stickers/80/Viggo.png"; break;
          case 303 : imgSource = "img/Stickers/80/Perry.png"; break;
          case 339 : imgSource = "img/Stickers/80/Combine-Helmet-Holo.png"; break;
          case 542 : imgSource = "img/Stickers/80/Jack-Holo.png"; break;
          case 546 : imgSource = "img/Stickers/80/Crown.png"; break;
          case 557 : imgSource = "img/Stickers/80/Boris.png"; break;
          case 638 : imgSource = "img/Stickers/80/Max.png"; break;
          case 641 : imgSource = "img/Stickers/80/Stan.png"; break;
          case 642 : imgSource = "img/Stickers/80/Stan-Holo.png"; break;
          case 643 : imgSource = "img/Stickers/80/Boris-Holo.png"; break;
          case 671 : imgSource = "img/Stickers/80/Jack.png"; break;
          case 683 : imgSource = "img/Stickers/80/Joan.png"; break;
          case 719 : imgSource = "img/Stickers/80/Perry-Holo.png"; break;
          case 745 : imgSource = "img/Stickers/80/Viggo-Holo.png"; break;
          case 746 : imgSource = "img/Stickers/80/Max-Holo.png"; break;
          case 748 : imgSource = "img/Stickers/80/Joan-Holo.png"; break;
        }
        return imgSource;
      }
    });
  </script>

</body>
</html>